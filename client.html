<!--
A maior parte da formatação do site foi feita com Bulma
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <script src="gepeto.py"></script>
    <title>Chat - Redes</title>
</head>
<body>
<section class="hero is-small">
    <div class="container hero-body">
      <h1 class="title">
        CHAT - Redes
      </h1>
      <p class="subtitle">
        Mande mensagens para o servidor e se comunique com outros clientes
      </p>
    </div>
  </section>
  <div class="box container is-max-desktop is-flex is-justify-content-end" style="background-image: url(images/chat_background.png); height:39rem; overflow-y: auto">
      <div id="messageChatArea" class="messageArea is-justify-content-end is-align-items-end">
        <!-- aqui vai entrar a div das mensagens -->
      </div>
      <!-- Modal para avisar a conexão com o servidor -->
      <div id="cSModal" class="modal">
        <div class="modal-content">
          <div class="notification" style="position: fixed; bottom: 70%; width: 40rem; border-radius: 5rem">
            Conectado ao servidor
          </div>
        </div>
      </div>
      
      <div class="informationModal container is-flex is-justify-content-center is-align-items-center" style="color: black; text-shadow: 0.3rem 0rem 0.2rem whitesmoke;">
        <p class="informationModal">1 - Criar usuário <br> 2 - Autenticar usuário <br> 3 - Enviar mensagens <br> 0 - Sair</p>
      </div>
      <!-- formulário para enviar a mensagem -->
      <form class="" onsubmit="return false"> <!--O submit dessa parte está falso pois quando o enter é pressionado a página recarrega. Mudar isso-->
        <div class="messageInput is-flex is-justify-content-space-between is-absolute mt-6" style="position: fixed; bottom: 7%; right: 19%; width: 58rem">
        <input type="text" id="messageInput" class="input is-rounded mr-2" placeholder="Escolha uma opção...">
        <button type="button" id="sendButton" class="button is-rounded">Send</button>
        </div>
    </form>
  </div>

  <script>
    var id = 0;
    // função para pegar a hora e os minutos atuais e adicionar na div com a class current-time
    function updateTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0'); // Ensures 2-digit format
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const currentTime = `${hours}:${minutes}`;

      document.getElementById(id).innerText = currentTime;
    }
    // função para adicionar as mensagens no chat
    function addMessage() {
    // pegar o valor/o que foi escrito no input
    const messageText = document.getElementById('messageInput').value;

    // Se o input não tiver vazio
    if (messageText.trim() !== '') {
    // Cria a estrutura HTML que será adicionada
    const userMessageDiv = document.createElement('div');
    userMessageDiv.classList.add('userMessage', 'is-flex', 'has-text-right', 'is-justify-content-end');

    userMessageDiv.innerHTML = `
    <div class="messageContent is-flex is-align-items-center">
      <div class="control notification is-small">
      <p>${messageText}</p>
      <div id=${id}></div>
      </div>
      <div class="imageContent is-flex is-justify-content-flex-end ml-4">
      <figure class="image is-48x48 is-flex">
          <img class="userImage is-rounded" src="/images/generic_user.jpg"/>
      </figure>
      </div>
    </div>
    `;

    // Adiciona a div criada na área do chat
    document.getElementById('messageChatArea').appendChild(userMessageDiv);

    // Limpa o input para novas mensagens
    document.getElementById('messageInput').value = '';

    // Adiciona o tempo atual na mensagem
    updateTime();
    if (id == 0) {
      id = id+1;
    } else {
      id = id+1;
    } 
      }

    document.getElementsByClassName("informationModal").setAttribute("style","display: none;");
    }

    document.getElementById('sendButton').addEventListener('click', addMessage);
    document.getElementById('messageInput').addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                addMessage();
            }})
     
    function openModal() {
      // verifica se o cliente se conectou ao servidor
      if (1==1) {
      // abre o modal
        document.getElementById('cSModal').classList.add('is-active');
        console.log('asodifasdfl');
        // timeout de 3 segundos
        setTimeout(() => {document.getElementById('cSModal').classList.remove('is-active')}, 3000);
        console.log('oimundo');
          
      } 
    }
    openModal();


  </script>
</body>
</html>
